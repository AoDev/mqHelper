/* Author: Kevin Purnelle

*/"use strict";function process(e){var t,n=[],r,i="",s={};i=e.replace(APP.mqRegex,"").trim();while(t=APP.mqRegex.exec(e)){t[1]=normalizeQuery(t[1]);n.push([t[1],t[2]])}n.sort(compareQueries);r=groupQueries(n);return{mqs:r,stripped:i}}function normalizeQuery(e){e=e.toLowerCase().trim().replace(/\s{2,}/g," ");e=e.replace(/\(\s/g,"(");e=e.replace(/\s\)/g,")");return e}function compareQueries(e,t){return e[0].localeCompare(t[0])}function groupQueries(e){var t={},n=[];if(e.length>0){t.query=e[0][0];t.rules="";for(var r=0,i=e.length;r<i;r++)if(e[r][0]===t.query)t.rules+=e[r][1];else{n.push(jQuery.extend({},t));t.query=e[r][0];t.rules=e[r][1]}n.push(t)}else n=null;return n}function resultToHtml(e,t){var n="",r="";if(APP.options.normal){n+="<h2> Your code with grouped media queries </h2>";if(APP.options.position==="bottom"){r+=e.stripped+"\n";for(var i=0,s=e.mqs.length;i<s;i++){r+=e.mqs[i].query+" {\n";r+=e.mqs[i].rules+"\n}\n"}}else{for(var i=0,s=e.mqs.length;i<s;i++){r+=e.mqs[i].query+" {\n";r+=e.mqs[i].rules+"\n}\n"}r+="\n"+e.stripped}n+="<div>";n+="<textarea>";n+=r;n+="</textarea>";n+="</div>"}if(APP.options.stripped||APP.options.groups){n+="<h2> Individual results </h2>";if(APP.options.stripped){n+="<h3> Code stripped from media queries </h3>";n+="<div>";n+="<textarea>";n+=e.stripped;n+="</textarea>";n+="</div>"}if(APP.options.groups){n+="<div>";for(var i=0,s=e.mqs.length;i<s;i++){n+="<h3>"+e.mqs[i].query+"</h3>";n+="<textarea>";n+=e.mqs[i].query+" {\n";n+=e.mqs[i].rules+"\n}";n+="</textarea>"}n+="</div>"}}return n}function setSourceExample(){var e=" /*Example*/\n	.somerule {\n	property1:value;\n}\n@media screen and (    max-width:979px){\n	.rule979-one {\n		property1:value;\n		property2:value\n	}\n	.rule979-two {\n		property1:value;\n		property2:value\n	}\n}\n@media screen and (max-width:480px){\n	.rule480-one {\n		property1:value;\n		property2:value\n	}\n	.rule480-two {\n		property1:value;\n		property2:value\n	}\n}\n@media screen AND (max-width:979px){\n	.rule979-again {\n		property1:value;\n	}\n}\n@media screen and (max-width:480px){\n	.rule480-again {\n		property1:value;\n		property2:value\n	}\n	.rule480-again2 {\n		property1:value;\n		property2:value\n	}\n}\n@media screen and (max-width:979px){\n	.rule979-again2 {\n		property1:value;\n	}\n}";APP.$.source.val(e)}var APP={$:{form:$("#test-form"),groups:$("#groups"),normal:$("#normal"),position:$("input:radio[name=mqposition]"),resultsWrapper:$("#results-container"),source:$("#textarea-source-code"),stripped:$("#stripped")},options:{stripped:null,groups:null,normal:!0,position:"bottom"},mqRegex:new RegExp(/(@media[^\{]*)\{(([^\{\}]*\{[^\{\}]*\})*)[^\}]*\}/gi)};$(document).ready(function(){setSourceExample();APP.$.normal.on("click",function(e){APP.options.normal=$(this).is(":checked")});APP.$.stripped.on("click",function(e){APP.options.stripped=$(this).is(":checked")});APP.$.groups.on("click",function(e){APP.options.groups=$(this).is(":checked")});APP.$.position.on("click",function(e){APP.options.position=$(this).val()});APP.$.form.on("submit",function(e){var t;e.preventDefault();t=process(APP.$.source.val());APP.$.resultsWrapper.html(resultToHtml(t))})});